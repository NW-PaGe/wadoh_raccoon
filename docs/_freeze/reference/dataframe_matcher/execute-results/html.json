{
  "hash": "ce1e53412636050093e00b3163be101d",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: dataframe_matcher\n---\n\n\n\n`dataframe_matcher`\n\n\n\n## Classes\n\n| Name | Description |\n| --- | --- |\n| [DataFrameMatcher](#wadoh_raccoon.dataframe_matcher.DataFrameMatcher) | A utility class for matching records. |\n\n### DataFrameMatcher { #wadoh_raccoon.dataframe_matcher.DataFrameMatcher }\n\n```python\ndataframe_matcher.DataFrameMatcher(\n    self,\n    df_subm: pl.DataFrame,\n    df_ref: pl.DataFrame,\n    threshold: int | float = 80,\n    first_name: str | None = None,\n    last_name: str | None = None,\n    dob: str | None = None,\n    spec_col_date: str | None = None,\n    first_name_src: str | None = None,\n    last_name_src: str | None = None,\n    dob_src: str | None = None,\n    spec_col_date_src: str | None = None,\n    first_name_ref: str | None = None,\n    last_name_ref: str | None = None,\n    dob_ref: str | None = None,\n    spec_col_date_ref: str | None = None,\n    key: str | None = None,\n)\n```\n\nA utility class for matching records.\n\nThis class provides functionality to match submissions to cases (epi \ndata) based on exact matching via accessions or fuzzy matching based on\npatient demographics.\n\nWhere the magic happens. Do the fuzzy matching to the dataframe\n\nParameters\n----------\ndob_match: pl.DataFrame\n    the dataframe that has records grouped by their dob match\n\nReturns\n----------\nfuzzy_matched: pl.DataFrame\n    dataframe with matches that met or exceeded the fuzzy matching score threshold\nfuzzy_unmatched: pl.DataFrame\n    dataframe with matches that failed to meet the fuzzy matching score threshold\n\nExamples\n--------\n\n\n**Step 1:** Import the packages:\n\n\n::: {#a432864c .cell execution_count=1}\n``` {.python .cell-code}\nfrom wadoh_raccoon import dataframe_matcher as dfm\nimport polars as pl\nfrom datetime import date\n```\n:::\n\n\n**Step 2:** The fuzzy matching functions need two dataframes to match. Bring your dataframe and the reference dataframe:\n\n::: {#b709ae7b .cell execution_count=2}\n``` {.python .cell-code}\n# Create example data\nyour_df = pl.DataFrame({\n    'submission_number': [453278555, 453278555, 887730141],\n    'first_name': ['DAVIS', 'DAVIS', 'GRANT'],\n    'last_name': ['SMITHDAVIS', 'SMITHDAVIS', 'MITHCELL'],\n    'sub_collection_date': [date(2024, 11, 29), date(2024, 11, 29), date(2024, 12, 2)],\n    'sub_dob': [date(1989, 7, 15), date(1989, 7, 15), date(1990, 6, 21)]\n})\n\nreference_df = pl.DataFrame({\n    'CASE_ID': [100000032, 100000041, 100020000],\n    'first_name_reference': ['DAVID', 'DAVID', 'TRASH'],\n    'last_name_reference': ['SMITDAVIS', 'SMITDAVIS', 'PANDA'],\n    'ref_collection_date': [date(2024, 11, 29), date(2024, 8, 31), date(2024, 8, 31)],\n    'ref_dob': [date(1989, 7, 15), date(1989, 7, 15), date(1990, 6, 21)]\n})\n```\n:::\n\n\n**Step 3:** Initalize the fuzzy matching class and input which dataframes and columns you are matching on\n\n::: {#58e87c91 .cell execution_count=3}\n``` {.python .cell-code}\nfuzzy_init = dfm.DataFrameMatcher(\n    df_subm=your_df,\n    df_ref=reference_df,\n    first_name_ref='first_name_reference',\n    last_name_ref='last_name_reference',\n    dob_ref='ref_dob',\n    spec_col_date_ref='ref_collection_date',\n    first_name_src='first_name',\n    last_name_src='last_name',\n    dob_src='sub_dob',\n    spec_col_date_src='sub_collection_date',\n    key='submission_number',\n    threshold=80 # set what kind of fuzzy threshold you want, 100 being exact match\n)\n```\n:::\n\n\n**Step 4:** Run fuzzy matching! This will output data on what matched and what didn't match.\n\n::: {#562982c3 .cell execution_count=4}\n``` {.python .cell-code}\nresult = fuzzy_init.match()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSuccess: No data leaks detected. Insert victory cigar\n0 exact matches\n1 fuzzy matched\n1 no match found\n0 records without demo\n\nTotal unique persons processed:  2 \nOriginal submissions to fuzzy (including no_match rematch attempt): 3\n```\n:::\n:::\n\n\nYou can also examine the output dataframes by pulling them out of the result class, like this:\n\n::: {#511d6422 .cell execution_count=5}\n``` {.python .cell-code}\nresult.fuzzy_unmatched\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (1, 23)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>submission_number</th><th>first_name</th><th>last_name</th><th>sub_collection_date</th><th>sub_dob</th><th>first_name_clean</th><th>last_name_clean</th><th>submitted_collection_date</th><th>submitted_dob</th><th>CASE_ID</th><th>first_name_reference</th><th>last_name_reference</th><th>ref_collection_date</th><th>ref_dob</th><th>first_name_clean_right</th><th>last_name_clean_right</th><th>reference_collection_date</th><th>first_name_result</th><th>last_name_result</th><th>reverse_first_name_result</th><th>reverse_last_name_result</th><th>match_ratio</th><th>reverse_match_ratio</th></tr><tr><td>i64</td><td>str</td><td>str</td><td>date</td><td>date</td><td>str</td><td>str</td><td>date</td><td>date</td><td>i64</td><td>str</td><td>str</td><td>date</td><td>date</td><td>str</td><td>str</td><td>date</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>887730141</td><td>&quot;GRANT&quot;</td><td>&quot;MITHCELL&quot;</td><td>2024-12-02</td><td>1990-06-21</td><td>&quot;GRANT&quot;</td><td>&quot;MITHCELL&quot;</td><td>2024-12-02</td><td>1990-06-21</td><td>100020000</td><td>&quot;TRASH&quot;</td><td>&quot;PANDA&quot;</td><td>2024-08-31</td><td>1990-06-21</td><td>&quot;TRASH&quot;</td><td>&quot;PANDA&quot;</td><td>2024-08-31</td><td>40</td><td>0</td><td>40</td><td>31</td><td>20.0</td><td>35.5</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {#20318999 .cell execution_count=6}\n``` {.python .cell-code}\nresult.fuzzy_matched\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (1, 24)</small><table border=\"1\" class=\"dataframe\"><thead><tr><th>submission_number</th><th>first_name</th><th>last_name</th><th>sub_collection_date</th><th>sub_dob</th><th>first_name_clean</th><th>last_name_clean</th><th>submitted_collection_date</th><th>submitted_dob</th><th>CASE_ID</th><th>first_name_reference</th><th>last_name_reference</th><th>ref_collection_date</th><th>ref_dob</th><th>first_name_clean_right</th><th>last_name_clean_right</th><th>reference_collection_date</th><th>first_name_result</th><th>last_name_result</th><th>reverse_first_name_result</th><th>reverse_last_name_result</th><th>match_ratio</th><th>reverse_match_ratio</th><th>business_day_count</th></tr><tr><td>i64</td><td>str</td><td>str</td><td>date</td><td>date</td><td>str</td><td>str</td><td>date</td><td>date</td><td>i64</td><td>str</td><td>str</td><td>date</td><td>date</td><td>str</td><td>str</td><td>date</td><td>i64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td><td>i32</td></tr></thead><tbody><tr><td>453278555</td><td>&quot;DAVIS&quot;</td><td>&quot;SMITHDAVIS&quot;</td><td>2024-11-29</td><td>1989-07-15</td><td>&quot;DAVIS&quot;</td><td>&quot;SMITHDAVIS&quot;</td><td>2024-11-29</td><td>1989-07-15</td><td>100000032</td><td>&quot;DAVID&quot;</td><td>&quot;SMITDAVIS&quot;</td><td>2024-11-29</td><td>1989-07-15</td><td>&quot;DAVID&quot;</td><td>&quot;SMITDAVIS&quot;</td><td>2024-11-29</td><td>80</td><td>95</td><td>71</td><td>53</td><td>87.5</td><td>62.0</td><td>0</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n#### Methods\n\n| Name | Description |\n| --- | --- |\n| [fuzzy_match](#wadoh_raccoon.dataframe_matcher.DataFrameMatcher.fuzzy_match) | Where the magic happens. Do the fuzzy matching to the dataframe |\n\n##### fuzzy_match { #wadoh_raccoon.dataframe_matcher.DataFrameMatcher.fuzzy_match }\n\n```python\ndataframe_matcher.DataFrameMatcher.fuzzy_match(dob_match)\n```\n\nWhere the magic happens. Do the fuzzy matching to the dataframe\n\n###### Parameters {.doc-section .doc-section-parameters}\n\n<code>[**dob_match**]{.parameter-name} [:]{.parameter-annotation-sep} []{.parameter-annotation}</code>\n\n:   the dataframe that has records grouped by their dob match\n\n###### Returns {.doc-section .doc-section-returns}\n\n<code>[**fuzzy_matched**]{.parameter-name} [:]{.parameter-annotation-sep} [pl.DataFrame]{.parameter-annotation}</code>\n\n:   dataframe with matches that met or exceeded the fuzzy matching score threshold\n\n<code>[**fuzzy_unmatched**]{.parameter-name} [:]{.parameter-annotation-sep} [pl.DataFrame]{.parameter-annotation}</code>\n\n:   dataframe with matches that failed to meet the fuzzy matching score threshold\n\n###### Examples {.doc-section .doc-section-examples}\n\n```python\nfrom wadoh_raccoon import dataframe_matcher as dfm\nimport polars as pl\nfrom datetime import date\n\n# Create example data\ndf = pl.DataFrame({\n    'submission_number': [453278555, 453278555, 887730141],\n    'first_name_clean': ['DAVIS', 'DAVIS', 'GRANT'],\n    'last_name_clean': ['SMITHDAVIS', 'SMITHDAVIS', 'MITHCELL'],\n    'submitted_collection_date': [date(2024, 11, 29), date(2024, 11, 29), date(2024, 12, 2)],\n    'submitted_dob': [date(1989, 7, 15), date(1989, 7, 15), date(1990, 6, 21)],\n     'CASE_ID': [100000032, 100000041, None],\n    'first_name_clean_right': ['DAVID', 'DAVID', None],\n    'last_name_clean_right': ['SMITDAVIS', 'SMITDAVIS', None],\n     'reference_collection_date': [date(2024, 11, 29), date(2024, 8, 31), None]\n})\n\n# Init dataframe matcher\n# (this is not how to use the instance but input data not used in this example)\ninstance = dfm.DataFrameMatcher(df, df)\nfuzzy_matched, fuzzy_unmatched = instance.fuzzy_match(dob_match=df)\n```\n\nFuzzy match found:\n```python\nhelpers.gt_style(df_inp=fuzzy_matched)\n```\n\nno matches found:\n```python\nhelpers.gt_style(df_inp=fuzzy_matched_none)\n```\n\n",
    "supporting": [
      "dataframe_matcher_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}